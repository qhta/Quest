<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QuestWASM</title>
  <base href="/" />
  <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
  <link rel="stylesheet" href="css/app.css" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <link href="QuestWASM.styles.css" rel="stylesheet" />
  <link href="manifest.webmanifest" rel="manifest" />
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
</head>

<body>
  <div id="app">
    <svg class="loading-progress">
      <circle r="40%" cx="50%" cy="50%" />
      <circle r="40%" cx="50%" cy="50%" />
    </svg>
    <div class="loading-progress-text"></div>
  </div>

  <div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ðŸ—™</a>
  </div>
  <script>
    window.blazorCulture = {
      get: () => window.localStorage['BlazorCulture'],
      set: (value) => window.localStorage['BlazorCulture'] = value
    };
  </script>
  <script src="_framework/blazor.webassembly.js"></script>
  <script>navigator.serviceWorker.register('service-worker.js');</script>
  <script>
    // Add this function for file download
    window.downloadFile = function (filename, contentType, base64Data) {
      const link = document.createElement('a');
      link.download = filename;
      link.href = `data:${contentType};base64,${base64Data}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };
  </script>

  <script>
    // Existing download function
    window.downloadFile = function (filename, contentType, base64Data) {
      const link = document.createElement('a');
      link.download = filename;
      link.href = `data:${contentType};base64,${base64Data}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };

    // New file open function
    window.openFileDialog = function (accept) {
      return new Promise((resolve) => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = accept;

        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) {
            resolve(null);
            return;
          }

          const reader = new FileReader();
          reader.onload = (event) => {
            const base64 = event.target.result.split(',')[1];
            resolve({
              fileName: file.name,
              base64Content: base64
            });
          };
          reader.onerror = () => resolve(null);
          reader.readAsDataURL(file);
        };

        input.oncancel = () => resolve(null);
        input.click();
      });
    };
  </script>
</body>

</html>
